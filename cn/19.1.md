# 19.1 分布式部署之使用Master-Slave集群

## replication
* master-slave 集群 （主从集群）
* replica set  (副本集)
* sharding (分片)

## master-slave 集群
write在master，read在slave中,通过oplog.$main 实现日志同步。
master配置:
```
logpath=/usr/local/mongodb/dblogs
logappend=true
fork=true
dbpath=/usr/local/mongodb/data
port=27017
bind_ip=10.11.0.1
master=true
```
slave配置:
```
logpath=/usr/local/mongodb/dblogs
logappend=true
fork=true
dbpath=/usr/local/mongodb/data
port=27017
slave=true
source=10.11.0.1:27017
```

分别启动后，进入slave机器，执行命令 rs.slaveOk()

## 设置auth的master-slave
对于master机器设置了数据库权限的话，slave的机器的搞法就稍微复杂了一点点

### 设置slave的权限与master一致
* 单独启动slave机器的mongo，按照master的权限在slave的机器上吧数据库用户添加一致，并用show users命令检查一遍
* 单独启动的conf文件
```
logpath=/usr/local/mongodb/dblogs
logappend=true
fork=true
dbpath=/usr/local/mongodb/data
port=27017
bind_ip=10.11.0.1
```
### 关闭slave机器
db.shutdownServer()
或者
kill -2 mongo进程
不要用kill -9

### 重新启动slave机器的mongo
conf配置文件指定master
```
logpath=/data/system/mongodb/dblogs
logappend=true
fork=true
dbpath=/data/system/mongodb/data
port=27017
slave=true
source=103.25.38.151:27017
```


## links
  * [目录](<preface.md>)
  * 上一节: [18.1 存储之WiredTiger,MMap,In-Memory三种存储引擎性能分析](<18.1.md>)
  * 下一节: 